language: minimal
dist: bionic

stages:
  - before_deploy
    if tag IS blank

script:
  - echo "So long, and thanks for all the fish." > artifact.txt

before_deploy:
  - curl -XDELETE --header "Authorization: token $GITHUB_APIKEY" "https://api.github.com/repos/${TRAVIS_REPO_SLUG}/git/refs/tags/unstable" || true
  - git config --local user.name "$GITHUB_USER"
  - git config --local user.email "$GITHUB_EMAIL"
  - export TRAVIS_TAG=unstable
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  api_key: $GITHUB_APIKEY
  file:
    - artifact.txt
  skip_cleanup: true
  overwrite: true
  on:
    branch: $TRAVIS_BRANCH

branches:
  except:
  - unstable
